<!DOCTYPE html>
<html>
<head>
    <title>Deployment Diagnostics</title>
</head>
<body>
    <h1>ChatApp Deployment Diagnostics</h1>
    
    <h2>Current Issues to Check:</h2>
    
    <h3>1. Server Status</h3>
    <p>❓ Is your Render service running? Check: <a href="https://chatter-qwcb.onrender.com/auth/user" target="_blank">https://chatter-qwcb.onrender.com/auth/user</a></p>
    <p>Expected: Either 401 (Unauthorized) or user data if logged in</p>
    
    <h3>2. Environment Variables</h3>
    <p>❓ Are these set in your Render dashboard?</p>
    <ul>
        <li>MONGODB_URI - Your MongoDB connection string</li>
        <li>GOOGLE_CLIENT_ID - From Google Cloud Console</li>
        <li>GOOGLE_CLIENT_SECRET - From Google Cloud Console</li>
        <li>SESSION_SECRET - Auto-generated by Render</li>
        <li>NODE_ENV = production</li>
        <li>CLIENT_URL = https://chatter-qwcb.onrender.com</li>
    </ul>
    
    <h3>3. Google OAuth Configuration</h3>
    <p>❓ In Google Cloud Console, do you have these redirect URIs?</p>
    <ul>
        <li>https://chatter-qwcb.onrender.com/auth/google/callback</li>
        <li>http://localhost:5000/auth/google/callback (for development)</li>
    </ul>
    
    <h3>4. MongoDB Connection</h3>
    <p>❓ Is your MongoDB URI clean of deprecated parameters?</p>
    <p>Remove these if present: sslValidate, ssl, bufferMaxEntries, useNewUrlParser, useUnifiedTopology</p>
    
    <h3>5. Render Service Status</h3>
    <p>❓ Check your Render dashboard:</p>
    <ul>
        <li>Is the service "Live" (green status)?</li>
        <li>Are there any error logs in the "Logs" tab?</li>
        <li>Did the latest deployment succeed?</li>
    </ul>
    
    <h3>6. Test OAuth Flow</h3>
    <ol>
        <li>Visit: <a href="https://chatter-qwcb.onrender.com" target="_blank">https://chatter-qwcb.onrender.com</a></li>
        <li>Click "Login with Google"</li>
        <li>Complete Google OAuth</li>
        <li>Check if you're redirected to the correct URL (NOT localhost)</li>
    </ol>
    
    <script>
        // Auto-detect current environment
        console.log('Current URL:', window.location.href);
        console.log('Environment detection:', window.location.hostname === 'localhost' ? 'Development' : 'Production');
        
        // Test API URL detection
        const getApiUrl = () => {
            // This mimics our frontend logic
            if (window.location.hostname === 'localhost') {
                return 'http://localhost:5000';
            }
            return window.location.origin;
        };
        
        console.log('Detected API URL:', getApiUrl());
        
        // Display info on page
        document.addEventListener('DOMContentLoaded', function() {
            const info = document.createElement('div');
            info.innerHTML = `
                <h3>Current Environment Detection</h3>
                <p><strong>Current URL:</strong> ${window.location.href}</p>
                <p><strong>Detected Environment:</strong> ${window.location.hostname === 'localhost' ? 'Development' : 'Production'}</p>
                <p><strong>API URL would be:</strong> ${getApiUrl()}</p>
            `;
            info.style.border = '2px solid #007bff';
            info.style.padding = '10px';
            info.style.margin = '20px 0';
            info.style.backgroundColor = '#f8f9fa';
            document.body.appendChild(info);
        });
    </script>
</body>
</html>
